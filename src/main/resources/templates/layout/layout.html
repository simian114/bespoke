<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
>
<script>
    const theme = localStorage.getItem('theme');
    if (theme) {
        document.documentElement.classList.add(theme);
    }
</script>
<head>
    <!--Common Head-->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport"
          content="width=device-width, maximum-scale=1.0, minimum-scale=1, user-scalable=yes,initial-scale=1.0"
    />

    <!--Common meta-->

    <title layout:title-pattern="$LAYOUT_TITLE - $CONTENT_TITLE"></title>

    <!--Common JS-->
    <!--query에버전을붙이는걸로 할 수 있을듯?-->
    <script type="text/javascript" th:src="@{/js/htmx.min.js(v=${randomValue})}"></script>
    <script type="text/javascript" th:src="@{/js/surreal.js(v=${randomValue})}"></script>
    <script type="text/javascript" th:src="@{/js/htmx-sse.js(v=${randomValue})}"></script>
    <script type="text/javascript" th:src="@{/js/nprogress.js(v=${randomValue})}"></script>

    <!-- toastify -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

    <!--Common CSS -->
    <link th:href="@{/css/application.css(v=${randomValue})}" rel="stylesheet" >
    <link th:href="@{/css/nprogress.css(v=${randomValue})}" rel="stylesheet"/>

    <link th:href="@{/css/fontawesome/brands.min.css(v=${randomValue})}" rel="stylesheet"/>
    <link th:href="@{/css/fontawesome/fontawesome.min.css(v=${randomValue})}" rel="stylesheet"/>
    <link th:href="@{/css/fontawesome/solid.min.css(v=${randomValue})}" rel="stylesheet"/>
    <link th:href="@{/css/fontawesome/regular.min.css(v=${randomValue})}" rel="stylesheet"/>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
</head>

<body hx-boost="true">
<header th:replace="~{layout/common/header :: header}"></header>
<main id="main">
    <th:block layout:fragment="content">
    </th:block>
</main>
<!-- TODO: footer -->
<footer th:replace="~{fragments/footer :: mainFooter}"></footer>
<div id="toast"></div>
<!--surreal-->
</body>
<!-- 한번만 실행되어야한다. -->
<script>
    document.addEventListener("DOMContentLoaded", () => {
        document.body.addEventListener("htmx:responseError", function (res) {
            let response = res.detail?.xhr?.response;
            let parsedResponse = JSON.parse(response);

            Toastify({
                text: parsedResponse.message,
                duration: 3000,
                close: true,
                gravity: "top",
                position: "center",
                stopOnFocus: true,
                style: {background: "linear-gradient(to right, #ff5f6d, #ffc371)"}
            }).showToast();
        })

        NProgress.configure({ showSpinner: false });

        window.addEventListener('htmx:beforeRequest', (event) => {
            if(event.detail.boosted) {
                NProgress.start();
            }
        });
        window.addEventListener('htmx:afterRequest', (event) => {
            if(event.detail.boosted) {
                NProgress.done();
            }
        });
        window.addEventListener('htmx:historyRestore', (event) => {
            NProgress.remove();
        });

    })
</script>

</html>