<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}"
      layout:fragment="content"
>
<head>
    <title>게시글 작성 | 수정</title>
    <!-- tinymce   -->
    <script type="text/javascript" th:src="@{/js/tinymce/tinymce.min.js}"></script>
</head>
<body>

<section class="section px-2">
    <nav th:replace="page/myblog/navigator :: navigator"></nav>
    <form class="container"
          enctype="multipart/form-data"
          hx-target="this" hx-swap="outerHTML"
          th:object="${post}"
          th:action
          hx-boost="true"
          method="post"
          style="max-width: 640px;"
    >
        <div class="container normal-field" th:fragment="normal-field">
            <!--  TODO: category 선택  -->
            <!-- NOTE: 마음에 들지 않음 -->
            <div layout:replace="~{fragments/form/layout-input :: input('title', 'Title', 'text', 'Title...', true)}">
                <script layout:fragment="script">
                    me().on("input", ev => {
                        const el = me(ev).querySelector("input");
                        const value = el?.value;
                        if (value.length === 0 || value.length > 50) {
                            el.classList.add("is-danger");
                            el.classList.remove("is-success");
                        } else {
                            el.classList.remove("is-danger");
                            el.classList.add("is-success");
                        }
                    })
                </script>
            </div>

            <div layout:replace="~{fragments/form/layout-input :: input('description', 'Description', 'text', 'Description.. this will be used for seo and preview', false)}">
                <script layout:fragment="script">
                    me().on("input", ev => {
                        const el = me(ev).querySelector("input");
                        const value = el?.value;
                        if (value.length === 0 || value.length > 200) {
                            el.classList.add("is-danger");
                            el.classList.remove("is-success");
                        } else {
                            el.classList.remove("is-danger");
                            el.classList.add("is-success");
                        }
                    })
                </script>
            </div>

            <!--  TODO: 커버 이미지 업로드  -->
            <div id="cover-input-container" class="file has-name field block is-flex-direction-column is-flex">
                <label class="label">Cover</label>
                <div class="control">
                    <label class="file-label">
                        <input class="file-input" type="file" name="cover"/>
                        <script>
                            me('prev').on("change", (ev) => {
                                const target = me(ev);
                                if (target?.files?.length > 0) {
                                    const fileName = document.querySelector("#cover-input-container .file-name");
                                    const img = document.querySelector("#cover-preview");
                                    fileName.textContent = target.files[0].name;
                                    img.src = URL.createObjectURL(target.files[0])
                                }
                            })
                        </script>
                        <span class="file-cta">
                        <span class="file-icon">
                          <i class="fas fa-upload"></i>
                        </span>
                        <span class="file-label"> Choose a file… </span>
                  </span>
                        <span class="file-name"> No file uploaded </span>
                    </label>
                </div>
                <details>
                    <summary>Cover preview</summary>
                    <article class="block content">
                            <figure class="image">
                            <img id="cover-preview" th:src="${post.prevCover != null ? post.prevCover.url : ''}"  src="https://bulma.io/assets/images/placeholders/128x128.png" />
                        </figure>
                    </article>
                </details>



            </div>

            <!--  TODO: 커버 이미지 끝  -->
            <th:block th:if="${categories != null}">
                <div class="field">
                    <label class="label">Category</label>
                    <div class="control">
                        <div class="select">
                            <select th:field="*{categoryId}">
                                <option value="">Choose Category</option>
                                <option th:value="${category.id}" th:each="category: ${categories}"
                                        th:text="${category.name}"></option>
                            </select>
                        </div>
                    </div>
                </div>
            </th:block>
        </div>

        <div layout:replace="fragments/form/layout-input :: tinymce('content', 'Content','hello world!', true, ${imageUploadUrl})"></div>

        <div class="field is-grouped">
            <div class="control">
                <button class="button is-link">Submit As Draft</button>
            </div>
            <div class="control">
                <button class="button is-link is-light">Cancel</button>
            </div>
        </div>
    </form>
</section>


</body>
</html>