<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}"
      layout:fragment="content"
>
<head>
    <title th:text="|${post.title}|">Bespoke</title>
</head>
<body>

<section class="common-page section px-2">
    <div class="container has-background-primary-100">
        <div class="post-header is-flex is-flex-direction-column">
            <h1 class="is-size-3 has-text-weight-semibold" style="text-align: center;word-break: keep-all;"
                th:text="${post.title}">
                title
            </h1>
            <!--  NOTE: 해당 영역은 api call로 변경하기  -->
            <div class="buttons are-small has-addons is-right">
                <button th:fragment="like" class="button" hx-target="this" hx-swap="outerHTML"
                        hx:delete="@{/blog/posts/{postId}/like(postId=${post.id})}"
                        th:if="${post.likedByUser}">
                    <span class="icon is-small is-color-danger">
                        <i class="fa-solid fa-heart"></i>
                    </span>
                    <span th:text="${post.countInfo.getLikeCount()}"></span>
                </button>
                <button th:fragment="cancel-like" class="button" hx-target="this" hx-swap="outerHTML"
                        hx:post="@{/blog/posts/{postId}/like(postId=${post.id})}"
                        th:unless="${post.likedByUser}">
                    <span class="icon is-small">
                        <i class="fa-regular fa-heart"></i>
                    </span>
                    <span th:text="${post.countInfo.getLikeCount()}"></span>
                </button>

                <!--  팔로우   -->
                <button hx-swap="outerHTML" th:fragment="follow" th:unless="${follow}" class="button"
                        hx:post="@{/blog/user/{userId}/follow(userId=${post.author.id})}"
                >
                        <span class="icon is-small">
                            <i th:if="${follow}" class="fa-solid fa-user-minus"></i>
                            <i th:unless="${follow}" class="fa-solid fa-user-plus"></i>
                        </span>
                </button>
                <!--  언팔로우   -->
                <button hx-swap="outerHTML" th:fragment="unfollow" th:if="${follow}" class="button"
                        hx:delete="@{/blog/user/{userId}/follow(userId=${post.author.id})}"
                >
                        <span class="icon is-small">
                            <i th:if="${follow}" class="fa-solid fa-user-minus"></i>
                            <i th:unless="${follow}" class="fa-solid fa-user-plus"></i>
                        </span>
                </button>
            </div>
            <div class="is-flex is-align-items-baseline is-justify-content-flex-end">
                <span style="text-align: end;"
                      th:text="|${#temporals.format(post.createdAt, 'yyyy.MM.dd')}. by |"></span>
                &nbsp;
                <a hx-boost="true" class="is-size-5 has-text-weight-semibold" th:text="${owner.nickname}"
                   th:href="@{/blog/{nickname}(nickname=${owner.nickname})}">
                    닉네임
                </a>
            </div>
        </div>
        <article class="content mt-4" th:utext="${post.getContent()}"></article>

        <!-- comment area -->
        <div class="comment-container is-flex is-flex-direction-column">
            <div>
                <span class="icon-text">
                    <span class="icon">
                        <i class="fa-regular fa-comment-dots"></i>
                    </span>
                    <span th:text="${post.countInfo.commentCount}">comment count</span>
                </span>
            </div>
            <div>
                <form th:action="@{/blog/posts/{postId}/comments(postId=${post.id})}"
                      hx-target=".comment-list"
                      hx-swap="afterbegin focus-scroll:false"
                      th:object="${comment}" method="post" hx-boost="true" th:fragment="comment-form">
                    <div layout:replace="~{fragments/form/layout-input :: textarea('content', '', 'comments..', 3, true, ${me == null ? true : false})}"></div>
                    <div class="field is-grouped">
                        <div class="control ml-auto">
                            <button class="button is-primary is-small">Submit</button>
                        </div>
                    </div>
                </form>
            </div>
            <div hx-trigger="revealed once"
                 hx:get="@{/blog/posts/{postId}/comments(postId=${post.id})}"
            >
                <!-- fill with comments -->
            </div>
        </div>
    </div>
</section>


</body>
</html>